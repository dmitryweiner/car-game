<html>
<head>
    <style>

        body {
            padding: 0;
            margin: 0;
        }

        #gameField {
            background-color: #adadad;
            position: absolute;
            width: 100%;
            height: 100%;
        }

        #car {
            position: absolute;
            top: 250px;
            left: 250px;
            height: 30px;
            width: 30px;
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AMaBi8XN9a9EQAABI5JREFUSMetl8tvVFUcxz/nnHvnzuvOtFD6Qii0BREVJcQiCgESFprUKCEuNGqIK4kxJpgQV/4BujG6sYkkJiTEqCFs0I1BCSHahRLkpdS2tKX0NbSd3unMfc09LqY+NvZOMr3JWd3f/X5+r/M75wrqeLryppnKZjMdttHTm/SOdye8F/Jm1KWBhUAOj/rJcyOedXZqKbhbWS4tjy0GQZymiDPYZEujtXVDvq8zeaQnmv30cFNlw+YcWGbtvRvA3SJcKqYm7hidJwfHl35YKDwoTjhRuJquEQfOZLOpvds7+vbbzhf7tZvc2Awy+e+Xdgjrbei03U1XlPrcV60v/VSu/IJTclbTlXHgVMrK79mYObUj4SbzWY3MAzaQWVlZkDnIZzR7Ml7+mZ51pzKZVD5ONxZ86PGtbb2mc8j2Z7CbAHOlOlXg72QmIJ2DtDfDo0nn+QOPdbU0DL4+ev9EizNO77oQAUQlgVuAyiz4BYiKgF9Lf4ft0lm+x7U/77/bcHNtbrb0YH9EqxXghoKyD9LQSBMMCaYGNJhpkArmiya7zyvGF1zRUHPpSGNJjeOCNjQFU3JzZgue1waAZU2xu32MzV4NrHSE1rHxxIMRYCqIJHw728n18X7anadoK28h0hHj6VEuj1xhb/d3HNtUWPGWNQADWmq+mWjm3MgRusIddGe76NrVC1pTGhEUCtN8crWPgMv0ty3XUcA6wIaSv4350a4PBlvoWR8wL6f5raiZvHGfiIi5YI55OU3RD3j/So59R8tIKW83DP7yWCJ15prPbGWRpuo9pKXxkxUca56IiEVvkemFMeaDCWZKRc4Oab56OWHuHXAbAwciEV6fiwjDJQy7TDVVYNKZ4kFgAppy5KObPSzlwlKF24sRR0gEDUf80aAa0IKPm1KCPmuY/rYy3d0+bTlIpqAkYMwVnLmhOLugQER8OKgGGgbnEkhHwXtPVHl1s8+iBwmgqkFIaM9BxxbN0wdCHr5gcvUWmFb8YIo1EFKwLq14o7vKvZICIViZGWgg0ivjswJvPxfQkpFIEd/W8Z5JQT5RxRQCpET/317RoDKQNKrUwa0jYtCGFGghEXGKEaQTIFmDiBFQm4CyVtQYuK5PNd7EVDIUQlBbdfmJYYigYfBoobJNUKsvUiBi0igEDE2XdzUMHp4pHxeSGljI2DmspGC84L7SMLiqdU5KAYiV5hKxyY60zq7J6YSQIGVdNa7WcRbX3dWlwEBTg6/aVSEshwZ6LfaxksLZ2gQ/FwwSStZSvsIR/4VKuHTTYqMNSorlhsEHd3a81dfhcX5SUdSCsjapVMGtQjkUlHxB0VXcmTQ5fTHDkxtC9m1rfafhGv86NPX90e7Mrde2L+z87I9WenI2RijJFCOkAlcYVLRkaE5x4pECc2Hq9xtjsxdiMxn7J2FKSOWG93dUnj243skvBeCJJJ628HUCoRXtpsfrvfOk02L869Gmk7cmyncWKlW/oettm4Wa8RKpNw+3HH7xoeUTXVZ4wDaCrND6n4lRigxnwlOXz43ZA6d/LFxsT/qVaZfqarp/ARZ4wEkqJfehAAAAAElFTkSuQmCC');
            z-index: 0;
        }

        .obstacle {
            position: absolute;
            height: 30px;
            width: 30px;
            text-align: center;
            vertical-align: middle;
            z-index: 0;
        }

        .obstacle p {
            color: white;
            margin: 6px 0 6px 0;
        }

        #score {
            position: absolute;
            right: 40px;
            top: 10px;
            color: darkgreen;
            z-index: 1;
        }

        #time {
            position: absolute;
            left: 40px;
            top: 10px;
            color: darkred;
            z-index: 1;
        }

    </style>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js'></script>
</head>
<body>
<script>

    var Game = (function () {
        var item_size = 30; //size of car and obstacle in pixels
        var score;
        var start_time;

        var collision = new Audio('collision.mp3');

        var max_x = null;
        var max_y = null;
        var x = null;
        var y = null;

        var v = 0.0;
        var v_decr = 0.05; // decrement of the velocity with time
        var v_acc = 0.2; // increment of the velocity with pressing accelerator
        var v_brake = 0.3; // decrement of brakes
        var v_max = 3.0;

        var angle = 0.0;
        var delta_angle = 5;

        var dt = 5; // step
        var quant = 50;

        //obstacles
        var obstacles = [];
        var max_obstacle_ttl = 12000;
        var min_obstacle_ttl = 12000;

        //keys
        var isArrowUpPressed = false;
        var isArrowDownPressed = false;
        var isArrowLeftPressed = false;
        var isArrowRightPressed = false;

        function keyUp(code) {
            switch (code) {
                case 37: // left
                    isArrowLeftPressed = false;
                    break;

                case 38: // up
                    isArrowUpPressed = false;
                    break;

                case 39: // right
                    isArrowRightPressed = false;
                    break;

                case 40: // down
                    isArrowDownPressed = false;
                    break;
            }
        }

        function keyDown(code) {
            switch (code) {
                case 37: // left
                    isArrowLeftPressed = true;
                    break;

                case 38: // up
                    isArrowUpPressed = true;
                    break;

                case 39: // right
                    isArrowRightPressed = true;
                    break;

                case 40: // down
                    isArrowDownPressed = true;
                    break;
            }
        }

        function handleKeys() {

            if (isArrowDownPressed) {
                v = v - v_brake;
                if (v < 0) {
                    v = 0;
                }
            } else if (isArrowUpPressed) {
                v = v + v_acc;
                if (v > v_max) {
                    v = v_max;
                }
            }

            if (isArrowLeftPressed) {
                angle = angle - delta_angle;
                if (angle < 0) {
                    angle = 360 + angle;
                }
            } else if (isArrowRightPressed) {
                angle = angle + delta_angle;
                if (angle > 359) {
                    angle = angle - 360;
                }
            }

        }

        function setGameField(maxX, maxY) {
            max_x = maxX;
            max_y = maxY;
            x = max_x / 2; //determine middle point
            y = max_y / 2;
            score = 0;
            start_time = new Date();
        }

        function toRadians(angle) {
            return angle * (Math.PI / 180);
        }


        function byteToHex(b) {
            var hexChar = ["0", "1", "2", "3", "4", "5", "6", "7","8", "9", "A", "B", "C", "D", "E", "F"];
            return hexChar[(b >> 4) & 0x0f] + hexChar[b & 0x0f];
        }

        function getRandomColor() {
            var phase = 0;
            var center = 128;
            var width = 127;
            var frequency = Math.PI*2;
            var i = Math.random();
            var red   = Math.sin(frequency*i+2+phase) * width + center;
            var green = Math.sin(frequency*i+0+phase) * width + center;
            var blue  = Math.sin(frequency*i+4+phase) * width + center;
            return '#' + byteToHex(red) + byteToHex(green) + byteToHex(blue);
        }

        function createObstacle() {
            var nextTime = Math.random() * 2000 + 3000;

            var obstacle = {
                ttl: Math.random() * (max_obstacle_ttl - min_obstacle_ttl) + min_obstacle_ttl, // time to live in ms
                x: (max_x - item_size) * Math.random(),
                y: (max_y - item_size) * Math.random(),
                color: getRandomColor()
            };

            obstacles.push(obstacle);

            window.setTimeout(createObstacle, nextTime);
        }

        function getObstacleId(obstacle) {
            return parseInt(obstacle.x) + '_' + parseInt(obstacle.y);
        }

        function redrawObstacles() {
            for (var i = 0; i < obstacles.length; i++) {
                var obstacleId = getObstacleId(obstacles[i]);
                var obstacleElement = $('#' + obstacleId);
                if (obstacleElement.length == 0) {//create if not exists
                    obstacleElement = $('<div id="' + obstacleId + '" class="obstacle"><p></p></div>');
                    obstacleElement.css({
                        left: obstacles[i].x,
                        top: obstacles[i].y,
                        'background-color': obstacles[i].color
                    });
                    $('#gameField').append(obstacleElement);
                }
                obstacleElement.css({opacity: obstacles[i].ttl / max_obstacle_ttl});

                //display here seconds to live
                obstacleElement.find('p').html(Math.round(obstacles[i].ttl / 1000));
            }
        }

        function handleObstacles() {
            var newObstacles = [];
            for (var i = 0; i < obstacles.length; i++) {
                var obstacleId = getObstacleId(obstacles[i]);
                obstacles[i].ttl -= quant;

                //handle collision
                if ((Math.abs(obstacles[i].x - x) < item_size) && (Math.abs(obstacles[i].y - y) < item_size)) {
                    collision.play();
                    score++;
                    $('#' + obstacleId).remove();
                    continue;
                }

                if (obstacles[i].ttl > 0) {
                    newObstacles.push(obstacles[i]);
                } else {
                    $('#' + obstacleId).remove();
                }

            }
            obstacles = newObstacles;
            redrawObstacles();
        }

        function redrawScreenMessages() {
            $('#score span').html(score);

            var currentTime = new Date();
            $('#time span').html(Math.floor((currentTime.getTime() - start_time.getTime()) / 1000));
        }

        function run() {
            handleKeys();
            handleObstacles();
            redrawScreenMessages();

            var x_old = x;
            var y_old = y;

            var vx = parseFloat(v * Math.sin(toRadians(180 - angle)));
            var vy = parseFloat(v * Math.cos(toRadians(180 - angle)));
            x = x + vx * dt;
            y = y + vy * dt;

            v = v - v_decr;
            if (v < 0) {
                v = 0;
            }

            //collision with border
            if (x > max_x || x < 0) {
                x = x_old;
                v = 0;
            }
            if (y > max_y || y < 0) {
                y = y_old;
                v = 0;
            }

            $('#car').css({ left: x, top: y, transform: 'rotate(' + angle + 'deg)' });
        }

        return {
            quant: quant,
            run: run,
            setGameField: setGameField,
            keyUp: keyUp,
            keyDown: keyDown,
            createObstacle: createObstacle
        }
    })();

    $(document).ready(function () {
        Game.setGameField(
                $('#gameField').width() - $('#car').width(),
                $('#gameField').height() - $('#car').height()
        );

        Game.createObstacle();

        window.setInterval(Game.run, Game.quant);

        $(document).keydown(function (e) {
            var keyCode = e.keyCode || e.which;
            if (keyCode > 40 || keyCode < 37) {
                return;
            }
            Game.keyDown(keyCode);
            e.preventDefault(); // prevent the default action (scroll / move caret)
        });

        $(document).keyup(function (e) {
            var keyCode = e.keyCode || e.which;
            if (keyCode > 40 || keyCode < 37) {
                return;
            }
            Game.keyUp(keyCode);
            e.preventDefault(); // prevent the default action (scroll / move caret)
        });
    });


</script>
<div id='gameField' style='width: 100%; height: 100%;'>
    <div id='car'></div>
    <div id='score'><h3>Score: <span></span></h3></div>
    <div id='time'><h3>Time: <span></span></h3></div>
</div>
</body>
<html>